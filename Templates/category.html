<!DOCTYPE html>
<html>
    <head>
        
        <title id="title"> </title>
        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
        <link rel="stylesheet" href="../static/category.css">

        <style>
            body{
            margin: 0;
            padding:0;
            font-family: sans-serif;
            background-color: whitesmoke;
            }
            .row{
               /* border: 1px solid rgb(22, 22, 22);*/
                color: black;
                border-collapse: separate;
            }
            .itemcol{
                border: solid whitesmoke 2px;
            }
            .itemcol:hover{
                border: solid lightgrey 2px;
                cursor: pointer;
            }
            .row img{
                object-fit:cover;
                height: 150px;
                width: 150px;
            }
            .p{
                 color:red;
                 position: absolute;
                 left:78%;
                 margin-top: 52px;

            
            }
            .container{
                
                max-width: 90%;
                
            }
        </style>

        <body>
            <div class = "container">
                <p id="categoryname" class="h3" align="center"></p>
                  
            </div>
            <script>
        
        function displayproducts(json,keys){
            var container = document.getElementsByClassName("container")[0]
            document.getElementById("categoryname").innerHTML = "Our " + json[keys[0]].Category_Name+"'s"
            var divR = null;
            for (var i = 0; i < keys.length; i++){
                console.log(json[keys[i]].Image);
                var div = document.createElement("div");
                var img = document.createElement("img");
                //img.setAttribute("src", "../static/Pictures/"+json[keys[i]].Image);
                var image = "Pictures/"+json[keys[i]].Image;
                img.src = "http://localhost:5000/static/"+image
                div.appendChild(img);
             //   document.getElementsByClassName("box")[0].appendChild(div);
                

                if(i % 3 == 0){
                    divR = document.createElement("div");
                    divR.setAttribute("class", "row itemrow");
                }
                container.appendChild(divR)
                

                        
                        var divC = document.createElement("div");
                        divC.setAttribute("class", "col-4 itemcol p-5")

                        var div = document.createElement("div");
                        div.setAttribute("class", "row");
                        div.onclick = function(){
                            console.log(this.parentElement.children[3].children[0].value)
                            window.location = "http://localhost:5000/"+this.parentElement.children[3].children[0].value;
                        }


                        var img  = document.createElement("img");
                        img.setAttribute("class", "img-fluid offset-1 col-8 itemimg");
                        img.setAttribute("src", "http://localhost:5000/static/Pictures/"+json[keys[i]].Image);
                        div.appendChild(img);

                        divC.appendChild(div);

                        div = document.createElement("div");
                        div.setAttribute("class", "row");
                        div.onclick = function(){
                            console.log(this.parentElement.children[3].children[0].value)
                            window.location = "http://localhost:5000/"+this.parentElement.children[3].children[0].value;
                        }

                        var text = document.createElement("p");
                        text.setAttribute("class", "h6");
                        text.innerHTML = json[keys[i]].Name;
                        div.appendChild(text);

                        divC.appendChild(div);
                    
                        

                        div = document.createElement("div");
                        div.setAttribute("class", "row");
                        div.onclick = function(){
                            console.log(this.parentElement.children[3].children[0].value)
                            window.location = "http://localhost:5000/"+this.parentElement.children[3].children[0].value;
                        }

                        text = document.createElement("p");
                        text.setAttribute("class", "h6");
                        text.setAttribute("align", "center")
                        text.innerHTML = json[keys[i]].Price + ",-";
                        div.appendChild(text);
                        divC.appendChild(div);

                        div = document.createElement("div");
                        div.setAttribute("class", "row");

                        btn = document.createElement("btn");
                        btn.setAttribute("class", "btn btn-primary");
                        btn.setAttribute("align", "center")
                        btn.value = keys[i];
                        btn.innerHTML = "Add to cart";

                        btn.onclick = function(){
                            var user = JSON.parse(localStorage.getItem("user"))
                            if(user == null){
                                localStorage.setItem("PrevPage", window.location.href);
                                window.location = "http://localhost:5000/"
                            }

                            var request = new XMLHttpRequest();
                            var id = this.value;
                            request.open("POST", "http://localhost:5000/Cart/?User_id="+user.user_id+"&Product_id="+id+"&Amount="+1, true);
                            request.onreadystatechange = function(){
                                if(this.readyState == 4 && this.status === 200){
                                    var answer = window.confirm("Product added to your cart, would you like to keep shopping? (cancel = no)")
                                    if(!answer){ //go to Cart
                                        window.location = "http://localhost:5000/cart/"
                                    }
                                }
                            }
                            request.send()
                        }
                        div.appendChild(btn);
                        divC.appendChild(div);

                        divR.appendChild(divC);


            }
        }

        var http= new XMLHttpRequest()
        var link = window.location.href.split("/")
        var id = link[link.length-2]
        http.open("GET","http://localhost:5000/Sort/"+id+"/")
        http.onreadystatechange=function(){
         
 
        if(this.readyState == 4 && this.status === 200){
            var json = JSON.parse(this.responseText)
            var keys = Object.keys(json)
            if(keys.length == 0){
                //window.location = "http://localhost:5000/";
                console.log(json)
            }
            displayproducts(json,keys)
        }else if(this.status != 200 && this.readyState == 4){
            window.location = "http://localhost:5000/";
        }
    }
          http.send()
            </script>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
        </body>
    </head>



</html>