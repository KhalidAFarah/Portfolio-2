<!DOCTYPE html>
<html>
    <head>
        
        <title id="title"> </title>
        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
        <link rel="stylesheet" href="http://localhost:5000/CSS/nav.css/">

        <meta charset="utf-8">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    </head>

        <body>
        
            <header class="container-fluid p-0">
                <div class="container-fluid bg-Dark" style="background-color: #212529;">
                    <div class="row">
                    <div class="col-1 align-self-center p-1">
                        <a class="a navlink" href="http://localhost:5000/category/3/" style="margin-left: 25%;">PC</a>
                    </div>
                    <div class="col-1 align-self-center p-1">
                        <a class="a navlink" href="http://localhost:5000/category/4/">Screens</a>
                    </div>
                    <div class="col-1 align-self-center ">
                        <a class="a navlink" href="http://localhost:5000/category/2/"> Graphic Cards</a>
                    </div>
                    <div class="col-1 align-self-center p-1 " style="margin-left: 4%;">
                        <a class="a navlink" href="http://localhost:5000/category/1/">Processor</a>
                    </div>
                    <div class="col-2 dropdown p-1 align-self-center">
                        
        
                        
                        <button class="navlink btn btn-dark dropdown-toggle accessories-toggle">Accessories</button>
                        
        
                    </div>
                    <div class="col-3 align-self-center p-1">
                        <input type="text" id = "livebox"placeholder="Type in an product.." class="form-control" style="border-radius: 15px; ">
                    </div>
                    <div class="col-1 align-self-center p-1 loginbtn">
                        <a  class="a col-12 navlink sendto"><div class="row">
                            
                                <img class="img" src="http://localhost:5000/img/user.png/" style="width: 40%;border-radius: 50%;margin-left: 
                                30%;margin-top: 5%;">
                            
                        </div>
                        <div class="row">
                            <h5 class="h5 sendtotext" style="font-size: 15px;position: relative;top: 0%;left: 0%;" align="center">Login</h5>
                        </div></a>
                    </div>
                    <div class="col-1 align-self-center p-1 cartbtn" tabindex="0">
                        <div class="row ">
                            <div class="col-8">
                                <div class="row">
                                    <img src="http://localhost:5000/img/cart.png/" class="img cartimg" aria-hidden="true" 
                                    style="width: 58.5%;border-radius: 50%;margin-left: 22%;margin-top: 5%;">
                                    
                                </div>
                                <div class="row">
                                    <h4 cclass="h5" style="font-size: 15px;position: relative;top: 0%;left: 0%;color: white;" align="center">Cart</h4>
                                </div>
                            </div>
                            <div class="col-4 bg-primary cartnumber">
                                <p class="cartnumberelement"></p>
                            </div>
                        </div>
                    </div>
                        
                </div>
        
        
            
                
                <div class="wrapper">
                    <div class="search-input">   
                        <p id ="list"></p>
                    </div>
                </div>    
            </header>
            <div class="cartdata"></div>
            <ul class="accessories-menu">
                <a href="http://localhost:5000/category/5/"><li class="accessories-item">Headset</li></a>
                <a href="http://localhost:5000/category/6/"><li class="accessories-item">Mouse</li></a>
                <a href="http://localhost:5000/category/7/"><li class="accessories-item">Keyboard</li></a>
                <a href="http://localhost:5000/category/8/"><li class="accessories-item">LED light</li></a>
            </ul>
            <div class="home-btn" style= "margin-top:-10%;">
                <a href="http://localhost:5000/"> <button style="margin-left:0%; width: 15%; height: 5%; font-family: sans-serif; font-size: initial; color:white;background-color: black;" > Home page <i class="fa fa-home"></i></button></a>
                
              </div>

            <div class = "container" style="margin-top: 5%;">
                <p id="categoryname" class="h3" align="center"></p>
                  
            </div>
            <style>
                
            body{
            margin: 0;
            padding:0;
            font-family: sans-serif;
            background-color: whitesmoke;
            }
            .itemcol{
                border: solid whitesmoke 2px;
            }
            .itemcol:hover{
                border: solid lightgrey 2px;
                cursor: pointer;
            }
            .itemcol img{
                object-fit:cover;
                height: 150px;
                width: 150px;
            }
            .p{
                 color:red;
                 position: absolute;
                 left:78%;
                 margin-top: 52px;
                  }
            .container{
                
                max-width: 90%;
                
            }
            </style>

            <script src="http://localhost:5000/JS/nav.js/"></script>

            <script>
                ready = false;
        
        function displayproducts(json,keys){
            var container = document.getElementsByClassName("container")[0];
            document.getElementById("categoryname").innerHTML = "Our " + json[keys[0]].Category_Name+"'s";
            document.getElementById("title").innerHTML=json[keys[0]].Category_Name+"'s";
            var divR = null;
            for (var i = 0; i < keys.length; i++){
                if(i % 3 == 0){
                    divR = document.createElement("div");
                    divR.setAttribute("class", "row itemrow");
                }
                container.appendChild(divR)
                

                        
                        var divC = document.createElement("div");
                        divC.setAttribute("class", "col-4 itemcol p-5")

                        var div = document.createElement("div");
                        div.setAttribute("class", "row");
                        div.onclick = function(){
                            console.log(this.parentElement.children[3].children[0].value)
                            window.location = "http://localhost:5000/"+this.parentElement.children[3].children[0].value;
                        }


                        var img  = document.createElement("img");
                        img.setAttribute("class", "img-fluid offset-3 col-8 itemimg");
                        img.setAttribute("src", "http://localhost:5000/static/Pictures/"+json[keys[i]].Image);
                        div.appendChild(img);

                        divC.appendChild(div);

                        div = document.createElement("div");
                        div.setAttribute("class", "row");
                        div.onclick = function(){
                            console.log(this.parentElement.children[3].children[0].value)
                            window.location = "http://localhost:5000/"+this.parentElement.children[3].children[0].value;
                        }

                        var text = document.createElement("p");
                        text.setAttribute("class", "h6");
                        text.setAttribute("align", "center");
                        text.innerHTML = json[keys[i]].Name;
                        div.appendChild(text);

                        divC.appendChild(div);
                    
                        

                        div = document.createElement("div");
                        div.setAttribute("class", "row");
                        div.onclick = function(){
                            console.log(this.parentElement.children[3].children[0].value)
                            window.location = "http://localhost:5000/"+this.parentElement.children[3].children[0].value;
                        }

                        text = document.createElement("p");
                        text.setAttribute("class", "h6");
                        text.setAttribute("align", "center")
                        text.innerHTML = json[keys[i]].Price + ",-";
                        div.appendChild(text);
                        divC.appendChild(div);

                        div = document.createElement("div");
                        div.setAttribute("class", "row");

                        btn = document.createElement("btn");
                        btn.setAttribute("class", "btn btn-primary");
                        btn.setAttribute("align", "center")
                        btn.value = keys[i];
                        btn.innerHTML = "Add to cart";

                        btn.onclick = function(){
                            var user = JSON.parse(localStorage.getItem("user"))
                            if(user == null){
                                localStorage.setItem("PrevPage", window.location.href);
                                window.location = "http://localhost:5000/"
                            }

                            var request = new XMLHttpRequest();
                            var id = this.value;
                            request.open("POST", "http://localhost:5000/Cart/?User_id="+user.user_id+"&Product_id="+id+"&Amount="+1, true);
                            request.onreadystatechange = function(){
                                if(this.readyState == 4 && this.status === 200){
                                    var answer = window.confirm("Added to cart, would you like to keep shopping?")
                                    getcart();
                                    if(!answer){ //go to Cart
                                        window.location = "http://localhost:5000/cart/"
                                    }
                                }else if(this.readyState == 4 && this.status != 200){
                            
                            window.location = "http://localhost:5000/Login/"
                            
                        }
                            }
                            request.send()
                        }
                        div.appendChild(btn);
                        divC.appendChild(div);

                        divR.appendChild(divC);


            }
        }

        var http= new XMLHttpRequest()
        var link = window.location.href.split("/")
        var id = link[link.length-2]
        http.open("GET","http://localhost:5000/Sort/"+id+"/", true)
        http.onreadystatechange=function(){
 
            if(this.readyState == 4 && this.status === 200){
                var json = JSON.parse(this.responseText)
                var keys = Object.keys(json)
                if(keys.length == 0){
                    window.location = "http://localhost:5000/";
                }else{
                    displayproducts(json,keys)
                }
            }else if(this.status != 200 && this.readyState == 4){
              window.location = "http://localhost:5000/";
            }
        }       
        //while(ready==false){console.log(ready)}
          http.send();

            </script>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
        </body>
    </head>



</html>